multiple_quiz_format = """
    ### 0. 형식
    - 문제(지문)
    - 1개의 정답 선택지
    - 3개의 오답 선택지
    - 문제 유형: 단일정답형 (Multiple Choice)
    - 모든 선택지의 외형(길이, 구조)은 'multiple_quiz_guidelines'의 3-B 원칙을 따름
"""

multiple_quiz_guidelines = """
    ### 1. 퀴즈의 핵심 원칙
    
    * **난이도**: DOK Level 3 - 전략적 사고(Strategic Thinking), 대학 수준의 추론·분석형 문제
    * **평가 방식:** 단순 암기(DOK 1)가 아닌, [전제]로부터 [결론]을 도출하는 **논리적 추론 과정(Reasoning Chain)**을 평가합니다.
    * **문제 구조:** 문제는 **[전제]**와 **[질문(Question)]**으로 구성됩니다.
    * **핵심:** [전제]에서 [결론]에 이르는 중간 추론 과정은 지문에 명시적으로 드러내지 않고, 학습자가 스스로 사고하도록 유도해야 합니다.
    
    ---
    
    ### 2. Reasoning Chain 설계 (가장 중요)
    
    모든 문제와 선택지는 'Reasoning Chain'을 기반으로 설계되어야 합니다.
    
    **A. 정답 Reasoning Chain (올바른 추론)**
    * 학습자가 밟아야 할 올바른 논리적 경로입니다.
    * 구조: `[전제] → [올바른 추론 1] → [올바른 추론 2] → [정답 결론]`
    
    **B. 오답 Flawed Chain (오류 추론)**
    * 학습자가 빠지기 쉬운 그럴싸한 논리적 오류입니다.
    * 구조: `[전제] → [오류 추론] → [오답 결론]`
    * **오답 유형 (필수)**
        1.  **부분 오류형:** 일부 사실은 맞지만, 핵심 추론 단계나 조건에 오류가 포함된 경우.
        2.  **오개념형:** 학습자가 자주 범하는 개념적 혼동을 반영한 경우.
        3.  **무관 사실형:** 명제 자체는 사실(Fact)이지만, 주어진 [전제]의 결론과는 인과관계가 없는 경우.
    
    ---
    
    ### 3. 선택지 구성 원칙
    
    **A. 논리적 타당성**
    * **정답:** [전제]로부터 도출되는 유일하고 명확한 논리적 결론이어야 합니다.
    * **오답:** 'Flawed Chain'에 기반하여, 그럴싸하지만 논리적으로 틀린 결론이어야 합니다.
    
    **B. 구조적/외형적 일관성 (필수 제약)**
    * **핵심:** 4개의 선택지는 문체, 어조, 문장 구조(복잡도), 길이가 시각적으로 구분되지 않아야 합니다.
    * **목표:** 학습자가 내용을 몰라도 "가장 길거나 짧은 답"을 찍을 수 없도록, 4개 선택지의 **'외형'**을 일치시킵니다.
    
    * **[명시적 제약 1: 길이]** 4개 선택지의 길이는 서로 **평균 길이의 ±20%** 이내여야 합니다. (예: 평균 100자일 때, 모든 선택지가 80~120자 범위 내 위치)
    * **[명시적 제약 2: 구조]** 4개 선택지는 **동일한 구문 구조와 복잡도**를 가져야 합니다.
    
    * **[예시: 실패 (Bad Example)]**
        (A) A는 B를 유발한다.
        (B) C는 D를 유발한다.
        (C) E는 F이며, G라는 조건 하에서는 H까지 유발할 수 있다. (X - 정답만 길고 복잡함)
        (D) I는 J를 유발한다.
    
    * **[예시: 성공 (Good Example)]**
        (A) A는 B 조건에서 C를 유발한다.
        (B) D는 E 조건에서 F를 유발한다.
        (C) G는 H 조건에서 I를 유발한다. (O - 모든 선택지가 동일한 구조와 복잡도를 가짐)
        (D) J는 K 조건에서 L을 유발한다.
    
    ---
    
    ### 4. 퀴즈 제작 5단계 절차 (Refine 루프 강화)
    
    **1단계: Reasoning Chain 설계**
    * [정답 Chain] 1개와 [오답 Chain] 3개(부분 오류, 오개념, 무관 사실 등 활용)를 사전에 명확히 정의합니다.
    
    **2단계: 문제(지문) 작성**
    * 1단계에서 정의한 [전제]를 바탕으로, 학습자가 숨겨진 추론(Reasoning Chain)을 하도록 유도하는 [질문]을 작성합니다.
    
    **3단계: 선택지 초안 작성**
    * [정답 Chain]의 결론으로 **정답** 초안을 작성합니다.
    * [오답 Chain]의 결론으로 **오답 3개**의 초안을 작성합니다. (이 단계에서는 논리에만 집중)
    
    **4단계: 구조적 일관성 강제 (Refine Loop)**
    * **[4-A: 기준 틀 설정]** 3단계 초안 4개를 비교하여, 가장 논리적으로 명확한 하나의 구조를 **'기준 틀(Template)'**로 설정합니다. (예: 'A는 B를 유발하여 C가 된다')
    * **[4-B: 강제 재작성]** 나머지 선택지들의 핵심 논리(Flawed Chain)는 유지하되, 이 **'기준 틀'에 정확히 맞게 문장을 재작성(Rewrite)하여** 4개의 외형을 강제로 일치시킵니다.
    * **[4-C: 제약 검증]** 재작성된 4개의 선택지가 **3.B의 [명시적 제약(길이 ±20%, 구조)]**을 완벽히 충족하는지 검사합니다. 충족하지 못하면 4-B로 돌아가 다시 수정합니다.
    
    **5단계: 해설 작성 및 최종 검토**
    * 아래 '5. 해설 작성 규칙'에 따라 해설을 작성합니다.
    * 6단계 체크리스트를 사용하여 최종 검토를 완료합니다.
    
    ---
    
    ### 5. 해설 작성 규칙
    
    * **핵심:** Reasoning Chain을 기반으로 정답의 논리와 오답의 오류를 명확히 대비시킵니다.
    * **형식 (총 4문장 이내)**
        * **[정답]** `[전제] → [올바른 추론] → [정답 결론]`의 핵심 연결고리를 1문장으로 요약합니다.
        * **[오답 A]** 해당 오답 Chain의 논리적 오류(예: 오개념, 인과 오류, 무관 사실)를 1문장으로 지적합니다.
        * **[오답 B]** 해당 오답 Chain의 논리적 오류를 1문장으로 지적합니다.
        * **[오답 C]** 해당 오답 Chain의 논리적 오류를 1문장으로 지적합니다.
    * **문체:** 단정형("~이다/아니다")을 사용하고 불필요한 배경 설명을 금지합니다.
    
    ---
    
    ### 6. 최종 품질 검토 체크리스트
    
    - [ ] **DOK 수준:** 문제가 단순 암기가 아닌 전략적 추론(DOK 3)을 요구하는가?
    - [ ] **Reasoning Chain:** 정답과 오답이 사전에 설계한 'Reasoning Chain' 및 'Flawed Chain'과 일치하는가?
    - [ ] **오답 매력도:** 오답이 '부분 오류', '오개념', '무관 사실' 원칙을 충실히 따르는가?
    - [ ] **[필수 검증] 외형 일관성 (3.B):** 4개 선택지가 명시된 **길이(±20%)** 및 **구조 제약**을 완벽히 준수하는가?
    - [ ] **논리 일관성:** 선택지 간 논리적 복잡도가 유사하며, 특정 답만 튀지 않는가?
    - [ ] **해설 품질:** 해설이 Reasoning Chain을 기반으로 각 선택지의 논리/오류를 명확히 설명하는가?
    """
